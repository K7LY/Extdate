# åç©«æ™‚ã®å‡¦ç†ç¢ºèªãƒ¬ãƒãƒ¼ãƒˆ

## æ¦‚è¦
ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯ã€ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒ—ãƒ¬ã‚¤ã‚¹ãƒ¡ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã®åç©«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã«ã¤ã„ã¦è©³ç´°ã«åˆ†æã—ãŸã‚‚ã®ã§ã™ã€‚

## åç©«å‡¦ç†ã®æµã‚Œ

### 1. åç©«ãƒ©ã‚¦ãƒ³ãƒ‰ã®åˆ¤å®š
**å ´æ‰€**: `GameManager.cs`ã®`IsHarvestRound()`ãƒ¡ã‚½ãƒƒãƒ‰
```csharp
// åç©«ãƒ©ã‚¦ãƒ³ãƒ‰: 4, 7, 9, 11, 13, 14
public int[] harvestRounds = { 4, 7, 9, 11, 13, 14 };
```

### 2. åç©«ãƒ•ã‚§ãƒ¼ã‚ºã®å®Ÿè¡Œ
**å ´æ‰€**: `GameManager.cs`ã®`ExecuteHarvest()`ãƒ¡ã‚½ãƒƒãƒ‰

åç©«ãƒ•ã‚§ãƒ¼ã‚ºã§ã¯ä»¥ä¸‹ã®å‡¦ç†ãŒé †ç•ªã«å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

#### 2.1 ä½œç‰©ã®åç©«
- å„ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«å¯¾ã—ã¦`player.HarvestCrops()`ã‚’å‘¼ã³å‡ºã—
- åç©«æ™‚ã®ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’ç™ºå‹•: `ExecuteAllTriggerableCards(OccupationTrigger.OnHarvest, player)`

#### 2.2 å®¶æ—ã®é¤Œã‚„ã‚Š
- `player.FeedFamily()`ã§é£Ÿæ–™æ¶ˆè²»
- é£Ÿæ–™ä¸è¶³ã®å ´åˆã€ä¹é£Ÿã‚«ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹ï¼ˆ-3ç‚¹ãƒšãƒŠãƒ«ãƒ†ã‚£ï¼‰

#### 2.3 å‹•ç‰©ã®ç¹æ®–
- `player.BreedAnimals()`ã§å‹•ç‰©ç¹æ®–
- ç¹æ®–æ™‚ã®ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚’ç™ºå‹•: `ExecuteAllTriggerableCards(OccupationTrigger.OnBreeding, player)`

### 3. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ¬ãƒ™ãƒ«ã®åç©«å‡¦ç†
**å ´æ‰€**: `Player.cs`ã®`HarvestCrops()`ãƒ¡ã‚½ãƒƒãƒ‰

```csharp
public void HarvestCrops()
{
    if (tileManager == null)
    {
        Debug.LogWarning($"{playerName}: TileManagerãŒè¨­å®šã•ã‚Œã¦ã„ãªã„ãŸã‚ã€åç©«ã§ãã¾ã›ã‚“");
        return;
    }
    
    var harvestedCrops = tileManager.HarvestCrops(this);
    
    // è·æ¥­åŠ¹æœã®ãƒˆãƒªã‚¬ãƒ¼
    TriggerOccupationEffects(OccupationTrigger.OnHarvest);
}
```

### 4. å®Ÿéš›ã®åç©«å‡¦ç†
**å ´æ‰€**: `TileManager.cs`ã®`HarvestCrops()`ãƒ¡ã‚½ãƒƒãƒ‰

#### 4.1 å‡¦ç†ã®è©³ç´°
1. **ç•‘ã®åº§æ¨™å–å¾—**: `player.GetAllFieldPositions()`ã§å…¨ç•‘ã®åº§æ¨™ã‚’å–å¾—
2. **å„ç•‘ã®ä½œç‰©ç¢ºèª**: å„åº§æ¨™ã®ç•‘ã«æ¤ãˆã‚‰ã‚ŒãŸä½œç‰©ã‚’ç¢ºèª
3. **ä½œç‰©ã®åç©«**: 
   - `field.HarvestCrop(cropType, 1)`ã§ç•‘ã‹ã‚‰1å€‹ãšã¤åç©«
   - `player.ReceiveResourceDirect(cropType, harvestedAmount, null, "harvest")`ã§ãƒªã‚½ãƒ¼ã‚¹è¿½åŠ 
4. **ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ã®æ›´æ–°**: `GetTile(position)?.RemovePlant(plantType, harvestedAmount)`ã§ã‚¿ã‚¤ãƒ«ã‹ã‚‰æ¤ç‰©ã‚’å‰Šé™¤
5. **çµ±è¨ˆè¨˜éŒ²**: åç©«é‡ã‚’è¨˜éŒ²ãƒ»ãƒ­ã‚°å‡ºåŠ›

#### 4.2 åç©«ãƒ«ãƒ¼ãƒ«
- å„ç•‘ã‹ã‚‰1å€‹ãšã¤åç©«
- åç©«ã—ãŸä½œç‰©ã¯è‡ªå‹•çš„ã«ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®ãƒªã‚½ãƒ¼ã‚¹ã«è¿½åŠ 
- ç•‘ã¨TileManagerã®ä¸¡æ–¹ã‹ã‚‰ä½œç‰©ã‚’å‰Šé™¤

#### 4.3 ãƒ‡ãƒãƒƒã‚°æƒ…å ±
```csharp
Debug.Log($"ğŸŒ¾ TileManager: {player.playerName}ã®åç©«ã‚’é–‹å§‹ã—ã¾ã™");
Debug.Log($"    åº§æ¨™({position.x}, {position.y})ã‹ã‚‰{GetResourceName(cropType)}ã‚’{harvestedAmount}å€‹åç©«");
Debug.Log($"  {player.playerName}ã®åç©«çµæœ:");
```

## ã‚«ãƒ¼ãƒ‰åŠ¹æœã®ç™ºå‹•

### åç©«æ™‚ãƒˆãƒªã‚¬ãƒ¼
**ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ—**: `OccupationTrigger.OnHarvest`

åç©«æ™‚ã«ç™ºå‹•ã™ã‚‹è·æ¥­ã‚«ãƒ¼ãƒ‰ã®ä¾‹ï¼š
- **è¾²å¤«**: åç©«æ™‚ã«è¿½åŠ ç©€ç‰©1å€‹ã‚’ç²å¾—
- ãã®ä»–ã®è·æ¥­åŠ¹æœã‚‚æ¡ä»¶ã«å¿œã˜ã¦ç™ºå‹•

### ç¹æ®–æ™‚ãƒˆãƒªã‚¬ãƒ¼
**ãƒˆãƒªã‚¬ãƒ¼ã‚¿ã‚¤ãƒ—**: `OccupationTrigger.OnBreeding`

å‹•ç‰©ç¹æ®–æ™‚ã«ç™ºå‹•ã™ã‚‹è·æ¥­ã‚«ãƒ¼ãƒ‰ã®åŠ¹æœ

## é£Ÿæ–™ã‚·ã‚¹ãƒ†ãƒ 

### å®¶æ—ã®é¤Œã‚„ã‚Š
**å ´æ‰€**: `Player.cs`ã®`FeedFamily()`ãƒ¡ã‚½ãƒƒãƒ‰

#### å¿…è¦é£Ÿæ–™ã®è¨ˆç®—
```csharp
public int GetFoodNeeded()
{
    return familyMembers * 2; // 1äººã«ã¤ã2é£Ÿæ–™
}
```

#### é£Ÿæ–™ä¸è¶³æ™‚ã®å‡¦ç†
1. åˆ©ç”¨å¯èƒ½ãªé£Ÿæ–™ã‚’å„ªå…ˆä½¿ç”¨
2. ResourceConverterã§ä»–ã®ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰é£Ÿæ–™ã‚’è‡ªå‹•å¤‰æ›
3. ãã‚Œã§ã‚‚ä¸è¶³ã®å ´åˆã€ä¹é£Ÿã‚«ãƒ¼ãƒ‰ã‚’å—ã‘å–ã‚‹

## å‹•ç‰©ã®ç¹æ®–

### ç¹æ®–ãƒ«ãƒ¼ãƒ«
**å ´æ‰€**: `Player.cs`ã®`BreedAnimals()`ãƒ¡ã‚½ãƒƒãƒ‰

```csharp
// å„å‹•ç‰©ç¨®ã§2åŒ¹ä»¥ä¸Šã„ã‚Œã°1åŒ¹å¢—ãˆã‚‹
if (GetResource(ResourceType.Sheep) >= 2 && CanHouseAnimals(ResourceType.Sheep, 1))
    ReceiveResourceDirect(ResourceType.Sheep, 1, null, "breeding");
```

### é£¼è‚²å¯èƒ½æ•°ã®åˆ¶é™
```csharp
public bool CanHouseAnimals(ResourceType animalType, int count)
{
    int capacity = pastures * 2 + stables; // ç‰§å ´1ã¤ã«ã¤ã2åŒ¹ã€å°å±‹1ã¤ã«ã¤ã1åŒ¹
    int currentAnimals = GetResource(ResourceType.Sheep) + GetResource(ResourceType.Boar) + GetResource(ResourceType.Cattle);
    
    return currentAnimals + count <= capacity;
}
```

## åç©«ã®æœ€é©åŒ–

### 5äººãƒ—ãƒ¬ã‚¤ã§ã®è¿½åŠ ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
**å ´æ‰€**: `FivePlayerActionSpaceSetup.cs`

- **è‘¦ã®åç©«**: è‘¦2å€‹ç²å¾—
- **é‡èœã®åç©«**: é‡èœã‚’åç©«
- **åç©«ã®æœ€é©åŒ–**: æ¬¡ã®åç©«ã§è¿½åŠ ã®åç©«ç‰©ã‚’å¾—ã‚‹

### ä¸€æ™‚çš„ãƒœãƒ¼ãƒŠã‚¹
**å ´æ‰€**: `ActionSpace.cs`ã®åç©«æœ€é©åŒ–å‡¦ç†

```csharp
case "åç©«ã®æœ€é©åŒ–":
    player.AddTempBonus("harvest_bonus", 1);
    Debug.Log($"{player.playerName}ãŒåç©«æœ€é©åŒ–åŠ¹æœã‚’å¾—ã¾ã—ãŸ");
```

## ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°æ©Ÿèƒ½

### åç©«ãƒ†ã‚¹ãƒˆ
è¤‡æ•°ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§åç©«å‡¦ç†ã®ãƒ†ã‚¹ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ï¼š
- `ComprehensiveGameTest.cs`
- `FivePlayerGameTest.cs`
- `CardSystemTest.cs`

### ãƒ‡ãƒãƒƒã‚°å‡ºåŠ›
- åç©«é–‹å§‹/çµ‚äº†ã®è©³ç´°ãƒ­ã‚°
- å„ç•‘ã‹ã‚‰ã®åç©«é‡
- ç·åç©«é‡ã®çµ±è¨ˆ
- ã‚«ãƒ¼ãƒ‰åŠ¹æœã®ç™ºå‹•çŠ¶æ³

## çµ±åˆã‚·ã‚¹ãƒ†ãƒ 

### TileManagerã¨ã®é€£æº
- Player.csã®ç•‘ã‚·ã‚¹ãƒ†ãƒ ã¨TileManager.csã®ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ãŒé€£æº
- ç¨®ã¾ãæ™‚ï¼šä¸¡æ–¹ã«ä½œç‰©ã‚’è¿½åŠ 
- åç©«æ™‚ï¼šä¸¡æ–¹ã‹ã‚‰ä½œç‰©ã‚’å‰Šé™¤

### ã‚«ãƒ¼ãƒ‰ãƒˆãƒªã‚¬ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
- CardTriggerManagerãŒåç©«æ™‚ã®è·æ¥­åŠ¹æœã‚’ç®¡ç†
- æ¡ä»¶ãƒã‚§ãƒƒã‚¯ã¨åŠ¹æœå®Ÿè¡Œã‚’è‡ªå‹•åŒ–

## ä»Šå¾Œã®æ”¹å–„ç‚¹

1. **åç©«é‡ã®èª¿æ•´**: ç¾åœ¨ã¯1å€‹å›ºå®šã€å°†æ¥çš„ã«è¤‡æ•°å€‹åç©«ã®å¯èƒ½æ€§
2. **å­£ç¯€ã‚·ã‚¹ãƒ†ãƒ **: ä½œç‰©ã®æˆé•·æ™‚é–“ã‚„å­£ç¯€ã«ã‚ˆã‚‹åç©«é‡å¤‰å‹•
3. **å¤©å€™ã‚·ã‚¹ãƒ†ãƒ **: åç©«ã«å½±éŸ¿ã‚’ä¸ãˆã‚‹å¤©å€™åŠ¹æœ
4. **åç©«é“å…·**: åç©«åŠ¹ç‡ã‚’å‘ä¸Šã•ã›ã‚‹é“å…·ã®å®Ÿè£…

## ã¾ã¨ã‚

åç©«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ ã¯ä»¥ä¸‹ã®ç‰¹å¾´ã‚’æŒã¡ã¾ã™ï¼š
- **å¤šå±¤æ§‹é€ **: GameManager â†’ Player â†’ TileManager ã®éšå±¤çš„å‡¦ç†
- **å®Œå…¨çµ±åˆ**: ç•‘ã‚·ã‚¹ãƒ†ãƒ ã€ã‚¿ã‚¤ãƒ«ãƒãƒƒãƒ—ã€ã‚«ãƒ¼ãƒ‰åŠ¹æœãŒé€£æº
- **è‡ªå‹•åŒ–**: åç©«ã‹ã‚‰é¤Œã‚„ã‚Šã€ç¹æ®–ã¾ã§è‡ªå‹•å®Ÿè¡Œ
- **æ‹¡å¼µæ€§**: æ–°ã—ã„ã‚«ãƒ¼ãƒ‰åŠ¹æœã‚„ç‰¹æ®Šãƒ«ãƒ¼ãƒ«ã«å¯¾å¿œå¯èƒ½
- **ãƒ‡ãƒãƒƒã‚°å¯¾å¿œ**: è©³ç´°ãªãƒ­ã‚°å‡ºåŠ›ã§ãƒ†ã‚¹ãƒˆãƒ»èª¿æ•´ãŒå®¹æ˜“

ã“ã®ä»•çµ„ã¿ã«ã‚ˆã£ã¦ã€Agricolaã‚¹ã‚¿ã‚¤ãƒ«ã®è¤‡é›‘ãªåç©«ã‚·ã‚¹ãƒ†ãƒ ãŒå®Ÿç¾ã•ã‚Œã¦ã„ã¾ã™ã€‚